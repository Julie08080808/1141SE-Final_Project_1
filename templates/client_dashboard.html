<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æš¨æŸ´å·¥ä½œå§”è¨—å¹³å°</title>
<style>
    :root {
        --pink-light: #FFF8F9;
        --pink-nav: #FEDFE5;
        --pink-active-tab: #FDBDCB;
        --theme-red: #FF5E7E;
        --text: #333;
        --text-light: #555;
        --border-color: #EEE;
        --white: #FFFFFF;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: var(--pink-light);
        color: var(--text);
        margin: 0;
    }

    /* ğŸŒ¸ é ‚éƒ¨å°è¦½åˆ—ï¼ˆçµ±ä¸€ client_browse_projects æ¨£å¼ï¼‰ */
    .top-header {
      background-color: var(--pink-nav);
      padding: 10px 30px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 80px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    
/* Logo å€å¡Š */
.logo-area {
  display: flex;
  align-items: center;
  gap: 10px;
}
.logo-area img {
  width: 50px;
  height: 50px;
  border-radius: 8px;
  transition: transform 0.3s;
}
.logo-area img:hover {
  transform: scale(1.05);
}
.logo-text {
  font-weight: bold;
  color: var(--text);
  font-size: 18px;
}

    /* å°è¦½åˆ— */
.top-nav a {
  margin: 0 15px;
  padding: 8px 18px;
  text-decoration: none;
  color: var(--text-light);
  font-weight: 500;
  border-radius: 10px;
  transition: 0.3s;
}
.top-nav a.active,
.top-nav a:hover {
  background-color: var(--white);
  color: var(--theme-red);
}
    /* ä½¿ç”¨è€…è³‡è¨Šï¼ˆé å³ï¼‰ */
.user-info {
  margin-left: auto;
  font-size: 16px;
  color: var(--text);
}
.user-info a {
  color: var(--text-light);
  text-decoration: none;
  margin-left: 15px;
}
.user-info a:hover {
  color: var(--theme-red);
}

    .dashboard-wrapper {
        display: flex;
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
    }
    .sidebar { flex: 0 0 200px; margin-right: 30px; }
    .sidebar-nav button {
        display: block;
        width: 100%;
        padding: 15px 20px;
        margin-bottom: 15px;
        border: none;
        border-radius: 15px;
        background-color: var(--white);
        font-size: 16px;
        font-weight: 500;
        color: var(--text-light);
        cursor: pointer;
        text-align: left;
        transition: background-color 0.3s, box-shadow 0.3s;
        box-shadow: var(--shadow);
    }
    .sidebar-nav button.active {
        background-color: var(--pink-active-tab);
        color: var(--theme-red);
        font-weight: bold;
    }

    .main-content { flex: 1; }
    .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    /* é€²éšç¯©é¸å€å¡Š */
.filter-bar {
    background: var(--white);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    max-width: 100%;
    box-sizing: border-box;
}

/* ç¯©é¸æ¨™é¡Œé–‹é—œ */
.filter-toggle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    user-select: none;
}
.filter-toggle h3 {
    margin: 0;
    font-size: 16px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
}
.filter-toggle-icon {
    font-size: 20px;
    transition: transform 0.3s;
}
.filter-toggle-icon.expanded {
    transform: rotate(180deg);
}

/* å±•é–‹å…§å®¹ */
.filter-content {
    display: none;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}
.filter-content.show {
    display: block;
}

/* æ¯è¡Œç¯©é¸åˆ— */
.filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 15px;
}

/* æ¯å€‹ç¯©é¸çµ„ */
.filter-group {
    flex: 1 1 250px;        /* æ¯å€‹æ¬„ä½æœ€å° 250pxï¼Œè‡ªå‹•ç­‰å¯¬ */
    max-width: 100%;        /* ä¸è¶…å‡ºå®¹å™¨ */
    display: flex;
    flex-direction: column;
    gap: 8px;
    box-sizing: border-box;
}

/* æ¨™ç±¤ */
.filter-group label {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-light);
}

/* è¼¸å…¥æ¬„ä½ */
.filter-group input,
.filter-group select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
    transition: border-color 0.3s;
}
.filter-group input:focus,
.filter-group select:focus {
    outline: none;
    border-color: var(--theme-red);
}

/* å€é–“è¼¸å…¥çµ„ */
.range-inputs {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 10px;
    width: 100%;
}
.range-separator {
    text-align: center;
    color: var(--text-light);
    font-weight: 500;
}

/* ç¯©é¸æŒ‰éˆ•åˆ— */
    .filter-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .btn-filter {
     background-color: var(--theme-red);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: opacity 0.3s;
    }
    .btn-filter:hover { opacity: 0.85; }
    .btn-reset {
      background-color: var(--white);
      border: 1px solid var(--border-color);
      color: var(--text-light);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.3s;
    }
    .btn-reset:hover {
    border-color: var(--theme-red);
    color: var(--theme-red);
     }
    
    .active-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
    }
    
    .filter-tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background-color: var(--pink-light);
        color: var(--theme-red);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
    }
    
    .filter-tag-close {
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
        line-height: 1;
    }
    
    .btn-create {
        background-color: var(--theme-red);
        border: none;
        color: white;
        padding: 12px 20px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
        text-decoration: none;
        transition: 0.3s;
    }
    .btn-create:hover { opacity: 0.85; }
    
    .table-container {
        background: var(--white);
        border-radius: 20px;
        padding: 20px;
        box-shadow: var(--shadow);
        overflow-x: auto;
    }
    .content-tab { display: none; }
    .content-tab.active { display: block; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td {
        border-bottom: 1px solid var(--border-color);
        padding: 15px;
        text-align: left;
        white-space: nowrap;
    }
    th { background-color: #fcfcfc; font-size: 14px; color: var(--text-light); }
    td { font-size: 15px; }
    tr:hover { background-color: var(--pink-light); }
    .status-open { color: #34A853; font-weight: bold; }
    .status-pending { color: #FFA500; font-weight: bold; }
    .btn-manage {
        background-color: var(--theme-red);
        border: none;
        color: white !important;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        text-decoration: none;
        display: inline-block;
    }
    
    .no-results {
        text-align: center;
        color: #999;
        padding: 40px;
        font-style: italic;
    }

/* --- [ æ–°å¢ï¼šå½ˆçª—æ¨£å¼ ] --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.5); z-index: 9999;
    display: flex; justify-content: center; align-items: center;
    opacity: 0; visibility: hidden; transition: opacity 0.3s;
}
.modal-overlay.show { opacity: 1; visibility: visible; }

.modal-card {
    background: white; width: 90%; max-width: 500px;
    border-radius: 15px; padding: 30px; position: relative;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    transform: translateY(-20px); transition: transform 0.3s;
}
.modal-overlay.show .modal-card { transform: translateY(0); }

.close-modal { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
.form-row { margin-bottom: 15px; }
.form-row label { display: block; font-weight: bold; margin-bottom: 5px; color: #444; }
.form-row select, .form-row textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
</style>
</head>
<body>

<header class="top-header">
  <div class="logo-area">
    <img src="/å·¥ä½œå¹³å°.png" alt="å¹³å°Logo">
    <div class="logo-text">work.ncnu</div>
  </div>

  <nav class="top-nav">
    <a href="/client/dashboard" class="active">æˆ‘çš„å°ˆæ¡ˆ</a>
    <a href="/history">æ­·å²å°ˆæ¡ˆ</a>
    <a href="/client/browse">å…¬é–‹æ‹›æ¨™å°ˆæ¡ˆ</a>
  </nav>

  <div class="user-info">
    ä½ å¥½ï½å§”è¨—äºº {{ user_name }} ğŸª¸
    <a href="/logout">ç™»å‡º</a>
  </div>
</header>

<div class="dashboard-wrapper">

    <nav class="sidebar">
        <div class="sidebar-nav">
            <button class="tab-button active" onclick="switchTab(event, 'bidding-content')">æ‹›æ¨™ä¸­å°ˆæ¡ˆ</button>
            <button class="tab-button" onclick="switchTab(event, 'pending-content')">å¾…çµæ¡ˆ</button>
            <button class="tab-button" onclick="switchTab(event, 'completed-content')">å·²çµæ¡ˆ</button>
            <button class="tab-button" onclick="switchTab(event, 'reviews-content')">å·²è©•åƒ¹</button>
        </div>
    </nav>

    <main class="main-content">
        <div class="content-header">
            <h2 id="content-title">æ‹›æ¨™ä¸­å°ˆæ¡ˆ</h2>
            <a href="/client/project/new" class="btn-create">+ å»ºç«‹æ–°å°ˆæ¡ˆ</a>
        </div>

        <!-- é€²éšç¯©é¸å€ -->
        <div class="filter-bar">
            <div class="filter-toggle" onclick="toggleFilter()">
                <h3>
                    <span>ğŸ”</span>
                    <span>é€²éšç¯©é¸</span>
                </h3>
                <span class="filter-toggle-icon" id="filterIcon">â–¼</span>
            </div>
            
            <div class="filter-content" id="filterContent">
                <div class="filter-row">
                    <!-- ç«¶æ¨™äººæ•¸ç¯©é¸ -->
                    <div class="filter-group">
                        <label>ç«¶æ¨™äººæ•¸</label>
                        <div class="range-inputs">
                            <input type="number" id="bidCountMin" placeholder="æœ€å°‘" min="0">
                            <span class="range-separator">~</span>
                            <input type="number" id="bidCountMax" placeholder="æœ€å¤š" min="0">
                        </div>
                    </div>
                    
                    <!-- é ç®—ç¯„åœç¯©é¸ -->
                    <div class="filter-group">
                        <label>é ç®—ç¯„åœ ($)</label>
                        <div class="range-inputs">
                            <input type="number" id="budgetMin" placeholder="æœ€ä½" min="0" step="100">
                            <span class="range-separator">~</span>
                            <input type="number" id="budgetMax" placeholder="æœ€é«˜" min="0" step="100">
                        </div>
                    </div>
                    
                    <!-- æˆªæ­¢æœŸé™ç¯©é¸ -->
                    <div class="filter-group">
                        <label>æˆªæ­¢æœŸé™</label>
                        <div class="range-inputs">
                            <input type="date" id="deadlineStart">
                            <span class="range-separator">~</span>
                            <input type="date" id="deadlineEnd">
                        </div>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn-filter" onclick="applyFilters()">å¥—ç”¨ç¯©é¸</button>
                    <button class="btn-reset" onclick="resetFilters()">æ¸…é™¤ç¯©é¸</button>
                </div>
                
                <div class="active-filters" id="activeFilters"></div>
            </div>
        </div>

        <!-- æ‹›æ¨™ä¸­å°ˆæ¡ˆ -->
        <div id="bidding-content" class="content-tab active">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å‰µå»ºæ™‚é–“</th>
                            <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                            <th>ç«¶æ¨™äºº</th>
                            <th>æˆ‘çš„é ç®—</th>
                            <th>æˆªæ­¢æœŸé™</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="biddingTableBody">
                        {% for proj in bidding_projects %}
                        <tr class="project-row" 
                            data-bid-count="{{ proj.bid_count or 0 }}"
                            data-budget="{{ proj.budget }}"
                            data-deadline="{{ proj.deadline.strftime('%Y-%m-%d') if proj.deadline else '' }}">
                            <td>{{ proj.created_at.strftime('%Y-%m-%d') if proj.created_at else 'N/A' }}</td>
                            <td><a href="/project/{{ proj['id'] or proj.id }}" style="color: var(--theme-red); text-decoration: none; font-weight: 500;">{{ proj.title }}</a></td>
                            <td>
                                {% if proj.bid_count and proj.bid_count > 0 %}
                                    <span style="color: #FFA500; font-weight: bold;">{{ proj.bid_count }} äººæŠ•æ¨™</span>
                                {% else %}
                                    <em style="color: #999;">(å°šç„¡æŠ•æ¨™)</em>
                                {% endif %}
                            </td>
                            <td>${{ "%.2f"|format(proj.budget) }}</td>
                            <td>{{ proj.deadline.strftime('%Y-%m-%d') if proj.deadline else 'N/A' }}</td>
                            <td><a href="/client/project/{{ proj.id }}/manage" class="btn-manage">ç®¡ç†</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div id="noResultsBidding" class="no-results" style="display: none;">
                    æ‰¾ä¸åˆ°ç¬¦åˆç¯©é¸æ¢ä»¶çš„å°ˆæ¡ˆ
                </div>
            </div>
        </div>

        <!-- å¾…çµæ¡ˆå°ˆæ¡ˆ -->
        <div id="pending-content" class="content-tab">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                            <th>ç‹€æ…‹</th>
                            <th>æ¥æ¡ˆäºº</th>
                            <th>é ç®—</th>
                            <th>æˆäº¤åƒ¹æ ¼</th>
                            <th>æˆªæ­¢æ—¥æœŸ</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for proj in pending_projects %}
                        <tr>
                            <td>{{ proj.title }}</td>
                            <td class="status-pending">
                                {% if proj.status.strip() == 'in_progress' %}é€²è¡Œä¸­{% elif proj.status.strip() == 'submitted' %}ç­‰å¾…é©—æ”¶{% else %}{{ proj.status }}{% endif %}
                            </td>
                            <td>{{ proj.contractor_name or '(éŒ¯èª¤:ç„¡æ¥æ¡ˆäºº)' }}</td>
                            <td>${{ "%.2f"|format(proj.budget) }}</td>
                            <td>{% if proj.final_price %}<b>${{ "%.2f"|format(proj.final_price) }}</b>{% else %}<em>(N/A)</em>{% endif %}</td>
                            <td>{{ proj.deadline.strftime('%Y-%m-%d') if proj.deadline else 'N/A' }}</td>
                            <td><a href="/client/project/{{ proj.id }}/manage" class="btn-manage">ç®¡ç†</a></td>
                        </tr>
                        {% endfor %}
                        {% if not pending_projects %}
                        <tr><td colspan="7" style="text-align:center;color:#999;">ç›®å‰æ²’æœ‰å¾…çµæ¡ˆçš„å°ˆæ¡ˆã€‚</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- å·²çµæ¡ˆå°ˆæ¡ˆ -->
        <div id="completed-content" class="content-tab">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                  <th>ç‹€æ…‹</th>
                  <th>æ¥æ¡ˆäºº</th>
                  <th>é ç®—</th>
                  <th>æˆäº¤åƒ¹æ ¼</th>
                  <th>æˆªæ­¢æ—¥æœŸ</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                {% for p in completed_projects %}
                <tr>
                  <td>{{ p.title }}</td>
                  <td class="status-pending">{% if p.status.strip() == 'completed' %}âœ… å·²çµæ¡ˆ{% else %}{{ p.status }}{% endif %}</td>
                  <td>{{ p.contractor_name or '(æœªç´€éŒ„)' }}</td>
                  <td>${{ "%.2f"|format(p.budget) }}</td>
                  <td>{% if p.final_price %}<b>${{ "%.2f"|format(p.final_price) }}</b>{% else %}<em>(N/A)</em>{% endif %}</td>
                  <td>{{ p.deadline.strftime('%Y-%m-%d') if p.deadline else 'N/A' }}</td>
                  <td><a href="/client/project/{{ p.id }}/manage" class="btn-manage">æŸ¥çœ‹</a></td>
                  <td>
                    <div style="display: flex; gap: 5px;">                
                        {% if p.has_reviewed %}
                        <span style="color: #888; background: #eee; padding: 5px 10px; border-radius: 4px; font-size: 0.9em; display:flex; align-items:center;">
                            ğŸ“ å·²è©•åƒ¹
                        </span>
                        {% elif p.is_review_expired %}
                        <span style="color: #999; font-size: 0.9em; font-style: italic; display:flex; align-items:center;">
                            â³ å·²éè©•åƒ¹æœŸé™
                        </span>
                        {% else %}
                        <button 
                         type="button"
                            onclick="openReviewModal('{{ p.id }}', '{{ p.title }}', '{{ p.final_price }}')"
                            class="btn-manage"
                            style="background-color: #FF5E7E; border: none; cursor: pointer;">
                            â­ è©•åƒ¹
                        </button>
                        {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% if not completed_projects %}
                <tr><td colspan="7" style="text-align:center;color:#999;">ç›®å‰æ²’æœ‰å·²çµæ¡ˆçš„å°ˆæ¡ˆã€‚</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
        <!-- å·²è©•åƒ¹å°ˆæ¡ˆ -->
        <div id="reviews-content" class="content-tab">
            <div class="table-container">
                {% if given_reviews %}
                <table>
                    <thead>
                        <tr>
                            <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                            <th>è©•åƒ¹å°è±¡</th>
                            <th>æ•´é«”è©•åˆ†</th>
                            <th>è©•åƒ¹å…§å®¹</th>
                            <th>æ—¥æœŸ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for review in given_reviews %}
                        <tr>
                            <td>
                                <a href="/project/{{ review.project_id }}" style="color: var(--theme-red); text-decoration: none;">
                                    {{ review.project_title }}
                                </a>
                            </td>
                            <td>
                                {{ review.reviewee_name }} <span style="font-size:0.8em; color:#888;">æ¥æ¡ˆäºº</span>
                            </td>
                            <td>
                                {% set avg = ((review.score_1 + review.score_2 + review.score_3) / 3) | round(1) %}
                            <span style="color: #f1c40f;">â˜… {{ avg }}</span>
                            </td>
                            <td>
                                <div style="font-style: italic; color: #444;">
                                    {{ review.comment if review.comment else '(ç„¡æ–‡å­—è©•è«–)' }}
                                </div>
                            </td>
                            <td style="color: #888; font-size: 0.9em;">
                                {{ review.created_at.strftime('%Y-%m-%d') }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div style="text-align: center; padding: 40px; color: #888;">
                    <p>ä½ å°šæœªè©•åƒ¹ä»»ä½•æ¥æ¡ˆäººã€‚</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div id="reviewModal" class="modal-overlay">
            <div class="modal-card">
                <span class="close-modal" onclick="closeReviewModal()">&times;</span>
                <h3 style="text-align: center; color: #333; margin-top: 0;">è©•åƒ¹æ¥æ¡ˆäºº</h3>
    
                <div style="background: #FFF8F9; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #555; font-size: 0.9em;">
                <div><strong>å°ˆæ¡ˆï¼š</strong> <span id="modal-title"></span></div>
                <div><strong>æˆäº¤é‡‘é¡ï¼š</strong> NT$ <span id="modal-price"></span></div>
            </div>

            <form id="reviewForm" method="POST">
                <div class="form-row">
                <label>1. ç”¢å‡ºå“è³ª (Quality)</label>
                <select name="score_1" required>
                    <option value="" disabled selected>è«‹çµ¦åˆ†...</option>
                    <option value="5">5åˆ† - å“è³ªå„ªç•°</option>
                    <option value="4">4åˆ† - å¾ˆå¥½</option>
                    <option value="3">3åˆ† - æ™®é€š</option>
                    <option value="2">2åˆ† - éœ€æ”¹é€²</option>
                    <option value="1">1åˆ† - æ¥µå·®</option>
                </select>
                </div>

                <div class="form-row">
                <label>2. åŸ·è¡Œæ•ˆç‡ (Efficiency)</label>
                <select name="score_2" required>
                    <option value="" disabled selected>è«‹çµ¦åˆ†...</option>
                    <option value="5">5åˆ† - ææ—©/æº–æ™‚</option>
                    <option value="4">4åˆ† - ç¨å¾®å»¶é²</option>
                    <option value="3">3åˆ† - æ™®é€š</option>
                    <option value="2">2åˆ† - ç¶“å¸¸æ‹–å»¶</option>
                    <option value="1">1åˆ† - åš´é‡é²äº¤</option>
                </select>
                </div>

                <div class="form-row">
                <label>3. åˆä½œæ…‹åº¦ (Attitude)</label>
                <select name="score_3" required>
                    <option value="" disabled selected>è«‹çµ¦åˆ†...</option>
                    <option value="5">5åˆ† - æºé€šæ„‰å¿«</option>
                    <option value="4">4åˆ† - é…åˆåº¦é«˜</option>
                    <option value="3">3åˆ† - æ™®é€š</option>
                    <option value="2">2åˆ† - è¢«å‹•</option>
                    <option value="1">1åˆ† - æ…‹åº¦æƒ¡åŠ£</option>
                </select>
                </div>

                <div class="form-row">
                    <label>å…¶ä»–è©•èª (é¸å¡«)</label>
                    <textarea name="comment" rows="3" placeholder="çµ¦æ¥æ¡ˆäººçš„å»ºè­°æˆ–é¼“å‹µ..."></textarea>
                </div>

                <button type="submit" class="btn-create" style="width: 100%; border: none;">é€å‡ºè©•åƒ¹</button>
            </form>
            </div>
        </div>
    </main>
</div>

<script>
// åˆ‡æ›åˆ†é 
function switchTab(event, tabId) {
    var tabcontent = document.getElementsByClassName("content-tab");
    for (var i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
        tabcontent[i].classList.remove("active");
    }
    document.getElementById(tabId).style.display = "block";
    document.getElementById(tabId).classList.add("active");

    var tabbuttons = document.getElementsByClassName("tab-button");
    for (var j = 0; j < tabbuttons.length; j++) {
        tabbuttons[j].classList.remove("active");
    }
    event.currentTarget.classList.add("active");

    document.getElementById("content-title").innerText = event.currentTarget.innerText;
}

// åˆ‡æ›ç¯©é¸å™¨é¡¯ç¤º
function toggleFilter() {
    const content = document.getElementById('filterContent');
    const icon = document.getElementById('filterIcon');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.classList.remove('expanded');
    } else {
        content.classList.add('show');
        icon.classList.add('expanded');
    }
}

// å¥—ç”¨ç¯©é¸
function applyFilters() {
    const bidCountMin = document.getElementById('bidCountMin').value;
    const bidCountMax = document.getElementById('bidCountMax').value;
    const budgetMin = document.getElementById('budgetMin').value;
    const budgetMax = document.getElementById('budgetMax').value;
    const deadlineStart = document.getElementById('deadlineStart').value;
    const deadlineEnd = document.getElementById('deadlineEnd').value;
    
    const rows = document.querySelectorAll('#biddingTableBody .project-row');
    let visibleCount = 0;
    
    rows.forEach(row => {
        let show = true;
        
        // ç«¶æ¨™äººæ•¸ç¯©é¸
        const bidCount = parseInt(row.dataset.bidCount);
        if (bidCountMin && bidCount < parseInt(bidCountMin)) show = false;
        if (bidCountMax && bidCount > parseInt(bidCountMax)) show = false;
        
        // é ç®—ç¯©é¸
        const budget = parseFloat(row.dataset.budget);
        if (budgetMin && budget < parseFloat(budgetMin)) show = false;
        if (budgetMax && budget > parseFloat(budgetMax)) show = false;
        
        // æˆªæ­¢æœŸé™ç¯©é¸
        const deadline = row.dataset.deadline;
        if (deadlineStart && deadline < deadlineStart) show = false;
        if (deadlineEnd && deadline > deadlineEnd) show = false;
        
        row.style.display = show ? '' : 'none';
        if (show) visibleCount++;
    });
    
    // é¡¯ç¤ºæˆ–éš±è—ã€Œç„¡çµæœã€è¨Šæ¯
    document.getElementById('noResultsBidding').style.display = visibleCount === 0 ? 'block' : 'none';
    
    // æ›´æ–°æ´»å‹•ç¯©é¸æ¨™ç±¤
    updateActiveFilters();
}

// é‡ç½®ç¯©é¸
function resetFilters() {
    document.getElementById('bidCountMin').value = '';
    document.getElementById('bidCountMax').value = '';
    document.getElementById('budgetMin').value = '';
    document.getElementById('budgetMax').value = '';
    document.getElementById('deadlineStart').value = '';
    document.getElementById('deadlineEnd').value = '';
    
    const rows = document.querySelectorAll('#biddingTableBody .project-row');
    rows.forEach(row => {
        row.style.display = '';
    });
    
    document.getElementById('noResultsBidding').style.display = 'none';
    updateActiveFilters();
}

// æ›´æ–°æ´»å‹•ç¯©é¸æ¨™ç±¤
function updateActiveFilters() {
    const container = document.getElementById('activeFilters');
    container.innerHTML = '';
    
    const filters = [];
    
    const bidCountMin = document.getElementById('bidCountMin').value;
    const bidCountMax = document.getElementById('bidCountMax').value;
    if (bidCountMin || bidCountMax) {
        let text = 'ç«¶æ¨™äººæ•¸: ';
        if (bidCountMin && bidCountMax) {
            text += `${bidCountMin} ~ ${bidCountMax} äºº`;
        } else if (bidCountMin) {
            text += `â‰¥ ${bidCountMin} äºº`;
        } else {
            text += `â‰¤ ${bidCountMax} äºº`;
        }
        filters.push({ type: 'bidCount', text });
    }
    
    const budgetMin = document.getElementById('budgetMin').value;
    const budgetMax = document.getElementById('budgetMax').value;
    if (budgetMin || budgetMax) {
        let text = 'é ç®—: ';
        if (budgetMin && budgetMax) {
            text += `$${budgetMin} ~ $${budgetMax}`;
        } else if (budgetMin) {
            text += `â‰¥ $${budgetMin}`;
        } else {
            text += `â‰¤ $${budgetMax}`;
        }
        filters.push({ type: 'budget', text });
    }
    
    const deadlineStart = document.getElementById('deadlineStart').value;
    const deadlineEnd = document.getElementById('deadlineEnd').value;
    if (deadlineStart || deadlineEnd) {
        let text = 'æˆªæ­¢æœŸé™: ';
        if (deadlineStart && deadlineEnd) {
            text += `${deadlineStart} ~ ${deadlineEnd}`;
        } else if (deadlineStart) {
            text += `â‰¥ ${deadlineStart}`;
        } else {
            text += `â‰¤ ${deadlineEnd}`;
        }
        filters.push({ type: 'deadline', text });
    }
    
    filters.forEach(filter => {
        const tag = document.createElement('div');
        tag.className = 'filter-tag';
        tag.innerHTML = `
            ${filter.text}
            <span class="filter-tag-close" onclick="removeFilter('${filter.type}')">Ã—</span>
        `;
        container.appendChild(tag);
    });
}

// ç§»é™¤ç‰¹å®šç¯©é¸
function removeFilter(type) {
    if (type === 'bidCount') {
        document.getElementById('bidCountMin').value = '';
        document.getElementById('bidCountMax').value = '';
    } else if (type === 'budget') {
        document.getElementById('budgetMin').value = '';
        document.getElementById('budgetMax').value = '';
    } else if (type === 'deadline') {
        document.getElementById('deadlineStart').value = '';
        document.getElementById('deadlineEnd').value = '';
    }
    applyFilters();
}

// é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
document.addEventListener("DOMContentLoaded", function() {
    document.getElementsByClassName("tab-button")[0].click();
});

function openReviewModal(projectId, title, price) {
  // 1. å¡«å…¥è³‡è¨Š
  document.getElementById('modal-title').innerText = title;
  document.getElementById('modal-price').innerText = price;

  // 2. è¨­å®šè¡¨å–® Action (é€å¾€ client è·¯ç”±)
  const form = document.getElementById('reviewForm');
  form.action = "/client/project/" + projectId + "/review";

  // 3. é¡¯ç¤º
  document.getElementById('reviewModal').classList.add('show');
}

function closeReviewModal() {
  document.getElementById('reviewModal').classList.remove('show');
}

// é»æ“ŠèƒŒæ™¯é—œé–‰
window.onclick = function(event) {
  const modal = document.getElementById('reviewModal');
  if (event.target == modal) {
    closeReviewModal();
  }
}
</script>

</body>
</html>