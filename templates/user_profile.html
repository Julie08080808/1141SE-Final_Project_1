<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ target_user.name }} çš„å€‹äººé¦–é  - æš¨æŸ´å·¥ä½œå§”è¨—å¹³å°</title>
<style>
    /* ğŸŒ¸ çµ±ä¸€çš„ CSS é¢¨æ ¼è®Šæ•¸ */
    :root {
        --pink-light: #FFF8F9;
        --pink-nav: #FEDFE5;
        --pink-active-tab: #FDBDCB;
        --theme-red: #FF5E7E;
        --text: #333;
        --text-light: #555;
        --border-color: #EEE;
        --white: #FFFFFF;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: var(--pink-light);
        color: var(--text);
        margin: 0;
    }

    /* ğŸŒ¸ é ‚éƒ¨å°è¦½åˆ— */
    .top-header {
      background-color: var(--pink-nav);
      padding: 10px 30px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 80px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .logo-area { display: flex; align-items: center; gap: 10px; }
    .logo-area img { width: 50px; height: 50px; border-radius: 8px; }
    .logo-text { font-weight: bold; color: var(--text); font-size: 18px; }

    .top-nav a {
      margin: 0 15px; padding: 8px 18px; text-decoration: none;
      color: var(--text-light); font-weight: 500; border-radius: 10px; transition: 0.3s;
    }
    .top-nav a:hover { background-color: var(--white); color: var(--theme-red); }
    
    .user-info { margin-left: auto; font-size: 16px; color: var(--text); }
    .user-info a { color: var(--text-light); text-decoration: none; margin-left: 15px; }

    /* ğŸŒ¸ ä¸»é«”å…§å®¹ (Profile Layout) */
    .profile-container {
        max-width: 1100px;
        margin: 40px auto;
        display: flex;
        gap: 30px;
        padding: 0 20px;
        align-items: flex-start; /* è®“å·¦å´å¡ç‰‡é«˜åº¦è‡ªé©æ‡‰ */
    }

    /* å·¦å´ï¼šå€‹äººå¡ç‰‡ */
    .profile-card {
        flex: 0 0 320px;
        background: var(--white);
        border-radius: 20px;
        padding: 40px 30px;
        text-align: center;
        box-shadow: var(--shadow);
        position: sticky;
        top: 20px;
    }

    .avatar {
        width: 120px; height: 120px; border-radius: 50%;
        margin-bottom: 15px; border: 5px solid var(--pink-light);
        object-fit: cover;
    }

    .user-name { font-size: 1.6em; font-weight: bold; margin: 10px 0; color: var(--text); }
    
    .user-role-badge {
        display: inline-block;
        background-color: var(--pink-active-tab);
        color: var(--theme-red);
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: bold;
        margin-bottom: 20px;
    }

    .big-score {
        font-size: 4em;
        font-weight: bold;
        color: var(--theme-red); /* æ”¹ç”¨ä¸»é¡Œç´… */
        margin: 10px 0;
        line-height: 1;
        letter-spacing: -2px;
    }
    .total-reviews { color: #888; font-size: 0.95em; margin-bottom: 30px; }

    /* åˆ†æ•¸æ¢ */
    .score-bars { text-align: left; padding-top: 20px; border-top: 1px solid var(--border-color); }
    .score-item { margin-bottom: 15px; }
    .score-label { display: flex; justify-content: space-between; font-size: 0.9em; margin-bottom: 6px; color: #666; font-weight: 500; }
    .progress-bg { background: #f0f0f0; height: 8px; border-radius: 4px; overflow: hidden; }
    .progress-fill { background: var(--theme-red); height: 100%; border-radius: 4px; transition: width 0.5s ease; }

    /* å³å´ï¼šè©•åƒ¹åˆ—è¡¨ */
    .reviews-section {
        flex: 1;
        background: var(--white);
        border-radius: 20px;
        padding: 30px 40px;
        box-shadow: var(--shadow);
    }

    .section-title {
        margin-top: 0;
        border-bottom: 2px solid var(--pink-nav); /* æ¨™é¡Œä¸‹åŠƒç·šæ”¹ç²‰è‰² */
        padding-bottom: 15px;
        margin-bottom: 20px;
        color: var(--text);
        font-size: 1.4em;
    }

    .review-item {
        border-bottom: 1px solid var(--border-color);
        padding: 25px 0;
        display: flex;
        gap: 20px;
    }
    .review-item:last-child { border-bottom: none; }

    /* å·¦é‚Šï¼šå°ˆæ¡ˆè³‡è¨Š */
    .review-meta { width: 140px; flex-shrink: 0; font-size: 0.9em; color: #888; }
    .review-date { display: block; margin-bottom: 5px; }
    .reviewer-name { font-weight: bold; color: #555; }

    /* å³é‚Šï¼šå…§å®¹ */
    .review-content { flex: 1; }
    .project-link {
        font-size: 1.1em; font-weight: bold; color: var(--text);
        text-decoration: none; display: block; margin-bottom: 8px;
    }
    .project-link:hover { color: var(--theme-red); }

    .review-stars { color: #f1c40f; margin-bottom: 10px; font-size: 1.1em; }
    
    .comment-box {
        background-color: var(--pink-light);
        padding: 15px;
        border-radius: 10px;
        color: #555;
        line-height: 1.6;
        font-style: italic;
    }
    .empty-state { text-align: center; color: #999; padding: 50px; font-size: 1.1em; }
</style>
</head>
<body>

<header class="top-header">
  <div class="logo-area">
    <img src="/å·¥ä½œå¹³å°.png" alt="å¹³å°Logo">
    <div class="logo-text">work.ncnu</div>
  </div>

  <nav class="top-nav">
    {% if user.user_type == 'client' %}
      <a href="/client/dashboard">æˆ‘çš„å°ˆæ¡ˆ</a>
      <a href="/history">æ­·å²å°ˆæ¡ˆ</a>
      <a href="/client/browse">å…¬é–‹æ‹›æ¨™å°ˆæ¡ˆ</a>
    {% else %}
      <a href="/contractor/my-bids">æˆ‘çš„å°ˆæ¡ˆ</a>
      <a href="/history">æ­·å²ç´€éŒ„</a>
      <a href="/contractor/dashboard">å…¬é–‹æ‹›æ¨™å°ˆæ¡ˆ</a>
    {% endif %}
  </nav>

  <div class="user-info">
    {{ user.name }}
    <a href="/logout">ç™»å‡º</a>
  </div>
</header>

<div class="profile-container">
  
  <div class="profile-card">
    <img class="avatar" src="https://ui-avatars.com/api/?name={{ target_user.name }}&background=random&size=256&color=fff" alt="Avatar">
    
    <h1 class="user-name">{{ target_user.name }}</h1>
    
    <span class="user-role-badge">
      {{ 'ğŸ† å„ªè³ªæ¥æ¡ˆäºº' if target_user.user_type == 'contractor' else 'ğŸ’¼ å„ªè³ªå§”è¨—äºº' }}
    </span>

    <div class="big-score">{{ stats.avg_score }}</div>
    <div class="total-reviews">
        <span style="color:#f1c40f">â˜…â˜…â˜…â˜…â˜…</span> ({{ stats.total_count }} å‰‡è©•åƒ¹)
    </div>

    <div class="score-bars">
  {% if target_user.user_type == 'contractor' %}
    <!-- æ¥æ¡ˆäººçš„è©•åˆ†é …ç›® -->
    <div class="score-item">
      <div class="score-label"><span>ç”¢å‡ºå“è³ª</span> <span>{{ stats.avg_score_1 }}</span></div>
      {% set width_1 = ((stats.avg_score_1 | float / 5) * 100) | round(1) %}
      <div class="progress-bg">
        <div class="progress-fill" style="width: {{ width_1 }}%;"></div>
      </div>
    </div>
    
    <div class="score-item">
      <div class="score-label"><span>åŸ·è¡Œæ•ˆç‡</span> <span>{{ stats.avg_score_2 }}</span></div>
      {% set width_2 = ((stats.avg_score_2 | float / 5) * 100) | round(1) %}
      <div class="progress-bg">
        <div class="progress-fill" style="width: {{ width_2 }}%;"></div>
      </div>
    </div>
    
    <div class="score-item">
      <div class="score-label"><span>åˆä½œæ…‹åº¦</span> <span>{{ stats.avg_score_3 }}</span></div>
      {% set width_3 = ((stats.avg_score_3 | float / 5) * 100) | round(1) %}
      <div class="progress-bg">
        <div class="progress-fill" style="width: {{ width_3 }}%;"></div>
      </div>
    </div>
    
  {% else %}
    <!-- å§”è¨—äººçš„è©•åˆ†é …ç›® -->
    <div class="score-item">
      <div class="score-label"><span>éœ€æ±‚åˆç†æ€§</span> <span>{{ stats.avg_score_1 }}</span></div>
      {% set width_1 = ((stats.avg_score_1 | float / 5) * 100) | round(1) %}
      <div class="progress-bg">
        <div class="progress-fill" style="width: {{ width_1 }}%;"></div>
      </div>
    </div>
    
    <div class="score-item">
      <div class="score-label"><span>é©—æ”¶é›£åº¦</span> <span>{{ stats.avg_score_2 }}</span></div>
      {% set width_2 = ((stats.avg_score_2 | float) / 5 * 100) | round(1) %}
      <div class="progress-bg">
        <div class="progress-fill" style="width: {{ width_2 }}%;"></div>
      </div>
    </div>
    
    <div class="score-item">
      <div class="score-label"><span>åˆä½œæ…‹åº¦</span> <span>{{ stats.avg_score_3 }}</span></div>
      {% set width_3 = ((stats.avg_score_3 | float / 5) * 100) | round(1) %}
      <div class="progress-bg">
        <div class="progress-fill" style="width: {{ width_3 }}%;"></div>
      </div>
    </div>
  {% endif %}
</div>

  <div class="reviews-section">
    <h2 class="section-title">è©³ç´°è©•åƒ¹ç´€éŒ„</h2>
    
    {% if reviews %}
      {% for review in reviews %}
      <div class="review-item">
        <div class="review-meta">
            <!-- âœ… ä¿®æ­£ï¼šè™•ç†æ—¥æœŸå¯èƒ½æ˜¯å­—ä¸²çš„æƒ…æ³ -->
            <span class="review-date">
              {% if review.created_at is string %}
                {{ review.created_at[:10] }}
              {% else %}
                {{ review.created_at.strftime('%Y-%m-%d') }}
              {% endif %}
            </span>
            <div class="reviewer-name">by {{ review.reviewer_name }}</div>
        </div>

        <div class="review-content">
            <a href="/project/{{ review.project_id }}" class="project-link">{{ review.project_title }}</a>
            
            <!-- âœ… ä¿®æ­£ï¼šç¢ºä¿åˆ†æ•¸æ˜¯æ•´æ•¸ -->
            {% set s1 = review.score_1|default(0)|int %}
            {% set s2 = review.score_2|default(0)|int %}
            {% set s3 = review.score_3|default(0)|int %}
            {% set avg = ((s1 + s2 + s3) / 3) | round(1) %}
            
            <div class="review-stars">
              <span style="color: #f1c40f;">â˜…</span> 
              <b>{{ avg }}</b>
              <span style="font-size: 0.85em; color: #999; margin-left: 8px;">
                 ( ç´°é …: {{ s1 }} / {{ s2 }} / {{ s3 }} )
              </span>
            </div>

            <div class="comment-box">
              "{{ review.comment if review.comment else 'å°æ–¹æœªç•™ä¸‹æ–‡å­—è©•è«–' }}"
            </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="empty-state">
        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“­</div>
        <p>æ­¤ä½¿ç”¨è€…å°šæœªæ”¶åˆ°ä»»ä½•è©•åƒ¹ã€‚</p>
      </div>
    {% endif %}
  </div>

</div>

</body>
</html>