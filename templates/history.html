<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æš¨æŸ´å·¥ä½œå§”è¨—å¹³å°</title>
<style>
    :root {
        --pink-light: #FFF8F9;
        --pink-nav: #FEDFE5;
        --pink-active-tab: #FDBDCB;
        --theme-red: #FF5E7E;
        --text: #333;
        --text-light: #555;
        --border-color: #EEE;
        --white: #FFFFFF;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: var(--pink-light);
        color: var(--text);
        margin: 0;
    }

/* ğŸŒ¸ é ‚éƒ¨å°è¦½åˆ—ï¼ˆçµ±ä¸€ client_browse_projects æ¨£å¼ï¼‰ */
.top-header {
  background-color: var(--pink-nav);
  padding: 10px 30px;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  gap: 40px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.logo-area {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-area img {
  width: 50px;
  height: 50px;
  border-radius: 8px;
  transition: transform 0.3s;
}

.logo-area img:hover {
  transform: scale(1.05);
}

.logo-text {
  font-weight: bold;
  color: var(--text);
  font-size: 18px;
}

.top-nav a {
  margin: 0 15px;
  padding: 8px 18px;
  text-decoration: none;
  color: var(--text-light);
  font-weight: 500;
  border-radius: 10px;
  transition: 0.3s;
}

.top-nav a.active,
.top-nav a:hover {
  background-color: var(--white);
  color: var(--theme-red);
}

.user-info {
  margin-left: auto;
  font-size: 16px;
  color: var(--text);
}

.user-info a {
  color: var(--text-light);
  text-decoration: none;
  margin-left: 15px;
}

.user-info a:hover {
  color: var(--theme-red);
}

    /* --- ä¸»å…§å®¹ --- */
    .dashboard-wrapper {
        max-width: 1400px;
        margin: 30px auto;
        padding: 0 20px;
    }

    .main-content { flex: 1; }
    .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .table-container {
        background: var(--white);
        border-radius: 20px;
        padding: 20px;
        box-shadow: var(--shadow);
        overflow-x: auto;
    }
    
    table { 
        border-collapse: collapse; 
        width: 100%; 
        margin-top: 10px;
        font-size: 14px;
    }
    
    th, td {
        border-bottom: 1px solid var(--border-color);
        padding: 12px 10px;
        text-align: left;
        white-space: nowrap;
    }
    
    th { 
        background-color: #fcfcfc; 
        font-size: 13px; 
        color: var(--text-light);
        font-weight: 600;
    }
    
    td { font-size: 14px; }
    tr:hover { background-color: var(--pink-light); }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 15px;
        font-weight: 600;
    }

    /* å§”è¨—äººç‹€æ…‹ */
    .status-open { 
        color: #2e7d32;
    }
    .status-progress { 
        color: #f57c00;
    }
    .status-submitted { 
        color: #f57c00;
    }
    .status-review { 
        color: #f57c00;
    }
    .status-completed { 
        color: #2e7d32;
    }

    /* æ¥æ¡ˆäººç‹€æ…‹ */
    .status-pending { 
        color: #2e7d32;
    }
    .status-accepted { 
        color: #f57c00;
    }
    .status-rejected { 
        color: #c62828;
    }

    /* åœ–ç¤º */
    .status-icon {
        font-size: 16px;
        line-height: 1;
    }

    .project-title-link {
        color: var(--theme-red);
        text-decoration: none;
        font-weight: 500;
    }

    .project-title-link:hover {
        text-decoration: underline;
    }

    .btn-manage {
        background-color: var(--theme-red);
        border: none;
        color: white !important;
        padding: 6px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        text-decoration: none;
        display: inline-block;
        font-size: 13px;
        transition: background-color 0.3s;
    }

    .btn-manage:hover {
        background-color: #ff7b9d;
    }

    .empty-message {
        text-align: center; 
        padding: 40px; 
        color: #999;
        font-size: 15px;
    }
</style>
</head>
<body>


<header class="top-header">
  <div class="logo-area">
    <img src="/å·¥ä½œå¹³å°.png" alt="å¹³å°Logo">
    <div class="logo-text">work.ncnu</div>
  </div>

  <nav class="top-nav">
    {% if user_type == 'client' %}
      <a href="/client/dashboard">æˆ‘çš„å°ˆæ¡ˆ</a>
    {% else %}
      <a href="/contractor/my-bids">æˆ‘çš„å°ˆæ¡ˆ</a>
    {% endif %}
    <a href="/history" class="active">æ­·å²å°ˆæ¡ˆ</a>
    {% if user_type == 'client' %}
      <a href="/client/my-reviews">æ”¶åˆ°è©•åƒ¹</a>
    {% else %}
      <a href="/contractor/my-reviews">æ”¶åˆ°è©•åƒ¹</a>
    {% endif %}
    {% if user_type == 'client' %}
      <a href="/client/browse">å…¬é–‹æ‹›æ¨™å°ˆæ¡ˆ</a>
    {% else %}
      <a href="/contractor/dashboard">å…¬é–‹æ‹›æ¨™å°ˆæ¡ˆ</a>
    {% endif %}
    <a href="/leaderboard">æ’è¡Œæ¦œ</a>
  </nav>
    {% if user_type == 'client' %}
    <div class="user-info">
        ä½ å¥½ï½å§”è¨—äºº {{ user_name }} ğŸª¸
        <a href="/logout">ç™»å‡º</a>
    </div>
    {% else %}
    <div class="user-info">
        ä½ å¥½ï½æ¥æ¡ˆäºº {{ user_name }} ğŸ¶
    <a href="/logout">ç™»å‡º</a>
    </div>
    {% endif %}
</header>


<div class="dashboard-wrapper">
    <main class="main-content">
        <div class="content-header">
            <h2>ğŸ•“ æ­·å²ç´€éŒ„ 
                {% if user_type == 'client' %}
                    (å§”è¨—äºº)
                {% else %}
                    (æ¥æ¡ˆäºº)
                {% endif %}
            </h2>
        </div>

        <div class="table-container">
            {% if projects %}
            
            <!-- ========== å§”è¨—äººè¦–åœ– ========== -->
            {% if user_type == 'client' %}
            <table>
                <thead>
                    <tr>
                        <th>å‰µç«‹æ™‚é–“</th>
                        <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                        <th>æ¥æ¡ˆäºº</th>
                        <th>å°ˆæ¡ˆç‹€æ…‹</th>
                        <th>æˆªæ­¢æ—¥æœŸ</th>
                        <th>å¯¦éš›å®Œæˆæ—¥æœŸ</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for proj in projects %}
                    <tr>
                        <td>{{ proj.created_at.strftime('%Y-%m-%d') if proj.created_at else 'N/A' }}</td>
                        <td>
                            <a href="/client/project/{{ proj.id }}/manage" class="project-title-link">
                                {{ proj.title }}
                            </a>
                        </td>
                        <td>
                            {% if proj.status.strip() == 'open' %}
                                {% if proj.bid_count and proj.bid_count > 0 %}
                                    <span style="color: #f57c00; font-weight: 500;">
                                        {{ proj.bid_count }} äººæŠ•æ¨™
                                    </span>
                                {% else %}
                                    <em style="color:#999;">å°šç„¡æŠ•æ¨™</em>
                                {% endif %}
                            {% elif proj.contractor_name %}
                                {{ proj.contractor_name.strip() }}
                            {% else %}
                                <em style="color:#999;">(æœªé¸æ¨™)</em>
                            {% endif %}
                        </td>
                        <td>
                            {% set status = proj.status.strip() %}
                            {% if status == 'open' %}
                                <span class="status-badge status-open">
                                    <span class="status-icon">ğŸ“¢</span>
                                    å…¬é–‹æ‹›æ¨™ä¸­
                                </span>
                            {% elif status == 'in_progress' %}
                                <span class="status-badge status-progress">
                                    <span class="status-icon">â³</span>
                                    é€²è¡Œä¸­
                                </span>
                            {% elif status == 'submitted' %}
                                <span class="status-badge status-progress">
                                    <span class="status-icon">â³</span>
                                    é€²è¡Œä¸­
                                </span>
                            {% elif status == 'review' %}
                                <span class="status-badge status-progress">
                                    <span class="status-icon">â³</span>
                                    é€²è¡Œä¸­
                                </span>
                            {% elif status == 'completed' %}
                                <span class="status-badge status-completed">
                                    <span class="status-icon">âœ…</span>
                                    å·²çµæ¡ˆ
                                </span>
                            {% else %}
                                <span class="status-badge">{{ status }}</span>
                            {% endif %}
                        </td>
                        <td>{{ proj.deadline.strftime('%Y-%m-%d') if proj.deadline else 'N/A' }}</td>
                        <td>
                            {% if proj.completed_at %}
                                {{ proj.completed_at.strftime('%Y-%m-%d') }}
                            {% else %}
                                <em style="color:#999;">-</em>
                            {% endif %}
                        </td>
                        <td>
                            <a href="/client/project/{{ proj.id }}/manage" class="btn-manage">æŸ¥çœ‹è©³æƒ…</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- ========== æ¥æ¡ˆäººè¦–åœ– ========== -->
            {% else %}
            <table>
                <thead>
                    <tr>
                        <th>æ¥æ¡ˆæ™‚é–“</th>
                        <th>å°ˆæ¡ˆæ¨™é¡Œ</th>
                        <th>å§”è¨—äºº</th>
                        <th>æˆ‘çš„ç‹€æ…‹</th>
                        <th>å§”è¨—äººé ç®—</th>
                        <th>æˆ‘çš„å ±åƒ¹</th>
                        <th>æˆªæ­¢æ—¥æœŸ</th>
                        <th>å¯¦éš›å®Œæˆæ—¥æœŸ</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for proj in projects %}
                    <tr>
                        <td>{{ proj.bid_created_at.strftime('%Y-%m-%d') if proj.bid_created_at else 'N/A' }}</td>
                        <td>
                            <a href="/project/{{ proj.id }}" class="project-title-link">
                                {{ proj.title }}
                            </a>
                        </td>
                        <td>
                            {% if proj.client_name %}
                                {{ proj.client_name.strip() }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            {% set my_status = proj.my_bid_status.strip() %}
                            {% set proj_status = proj.project_status.strip() if proj.project_status else proj.status.strip() %}
                            
                            {% if my_status == 'pending' %}
                                <span class="status-badge status-open">
                                    <span class="status-icon">ğŸ“¢</span>
                                    å…¬é–‹æ‹›æ¨™ä¸­
                                </span>
                            {% elif my_status == 'accepted' and proj_status == 'in_progress' %}
                                <span class="status-badge status-progress">
                                    <span class="status-icon">â³</span>
                                    é€²è¡Œä¸­
                                </span>
                            {% elif my_status == 'accepted' and proj_status == 'submitted' %}
                                <span class="status-badge status-progress">
                                    <span class="status-icon">â³</span>
                                    é€²è¡Œä¸­
                                </span>
                            {% elif my_status == 'accepted' and proj_status == 'review' %}
                                <span class="status-badge status-progress">
                                    <span class="status-icon">â³</span>
                                    é€²è¡Œä¸­
                                </span>
                            {% elif proj_status == 'completed' %}
                                <span class="status-badge status-completed">
                                    <span class="status-icon">âœ…</span>
                                    å·²çµæ¡ˆ
                                </span>
                            {% elif my_status == 'rejected' %}
                                <span class="status-badge status-rejected">
                                    <span class="status-icon">âŒ</span>
                                    æœªå¾—æ¨™
                                </span>
                            {% else %}
                                <span class="status-badge">{{ my_status }}</span>
                            {% endif %}
                        </td>
                        <td>${{ "%.2f"|format(proj.budget) if proj.budget else '0.00' }}</td>
                        <td>${{ "%.2f"|format(proj.price) if proj.price else '0.00' }}</td>
                        <td>{{ proj.deadline.strftime('%Y-%m-%d') if proj.deadline else 'N/A' }}</td>
                        <td>
                            {% if proj.completed_at %}
                                {{ proj.completed_at.strftime('%Y-%m-%d') }}
                            {% else %}
                                <em style="color:#999;">-</em>
                            {% endif %}
                        </td>
                        <td>
                            <a href="/project/{{ proj.id }}" class="btn-manage">æŸ¥çœ‹è©³æƒ…</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
            
            {% else %}
                <p class="empty-message">ç›®å‰æ²’æœ‰æ­·å²ç´€éŒ„ã€‚</p>
            {% endif %}
        </div>
    </main>
</div>

</body>
</html>